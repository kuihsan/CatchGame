<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8" />
  <title>Unity WebGL Player | BurgerCatch</title>
  <link rel="shortcut icon" href="TemplateData/favicon.ico" />
  <link rel="stylesheet" href="TemplateData/style.css" />
</head>

<body>
  <!-- ===================== -->
  <!-- UNITY CONTAINER -->
  <!-- ===================== -->

  <div id="unity-container" class="unity-desktop">
    <canvas id="unity-canvas" width="540" height="960"></canvas>

    <div id="unity-loading-bar">
      <div id="unity-logo"></div>
      <div id="unity-progress-bar-empty">
        <div id="unity-progress-bar-full"></div>
      </div>
    </div>

    <div id="unity-warning"></div>

    <div id="unity-footer">
      <div id="unity-webgl-logo"></div>
      <div id="unity-fullscreen-button"></div>
      <div id="unity-build-title">BurgerCatch</div>
    </div>
  </div>

  <!-- ===================== -->
  <!-- HTML NAME INPUT -->
  <!-- ===================== -->

  <input
    id="nameInput"
    type="text"
    placeholder="Enter your name"
    maxlength="50"
    autocomplete="off"
    style="
      position: absolute;
      top: 40%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px;
      font-size: 18px;
      display: none;
      z-index: 9999;
    "
  />

  <button
    id="startBtn"
    style="
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      padding: 12px 24px;
      font-size: 18px;
      display: none;
      z-index: 9999;
    "
  >
    Start
  </button>

  <!-- ===================== -->
  <!-- UNITY LOADER -->
  <!-- ===================== -->

  <script>
    let unityInstance = null;

    const container = document.getElementById("unity-container");
    const canvas = document.getElementById("unity-canvas");
    const loadingBar = document.getElementById("unity-loading-bar");
    const progressBarFull = document.getElementById("unity-progress-bar-full");
    const fullscreenButton = document.getElementById("unity-fullscreen-button");
    const warningBanner = document.getElementById("unity-warning");

    function unityShowBanner(msg, type) {
      const div = document.createElement("div");
      div.innerHTML = msg;
      warningBanner.appendChild(div);

      if (type === "error") {
        div.style = "background: red; padding: 10px;";
      } else if (type === "warning") {
        div.style = "background: yellow; padding: 10px;";
        setTimeout(() => warningBanner.removeChild(div), 5000);
      }
    }

    const buildUrl = "Build";
    const loaderUrl = buildUrl + "/CatchGame.loader.js";

    const config = {
      dataUrl: buildUrl + "/CatchGame.data.unityweb",
      frameworkUrl: buildUrl + "/CatchGame.framework.js.unityweb",
      codeUrl: buildUrl + "/CatchGame.wasm.unityweb",
      streamingAssetsUrl: "StreamingAssets",
      companyName: "DefaultCompany",
      productName: "BurgerCatch",
      productVersion: "1.0",
      showBanner: unityShowBanner,
    };

    // Mobile viewport
    if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
      const meta = document.createElement("meta");
      meta.name = "viewport";
      meta.content =
        "width=device-width, height=device-height, initial-scale=1.0, user-scalable=no";
      document.head.appendChild(meta);

      container.className = "unity-mobile";
      canvas.className = "unity-mobile";
    } else {
      canvas.style.width = "540px";
      canvas.style.height = "960px";
    }

    loadingBar.style.display = "block";

    const script = document.createElement("script");
    script.src = loaderUrl;
    script.onload = () => {
      createUnityInstance(canvas, config, (progress) => {
        progressBarFull.style.width = 100 * progress + "%";
      })
        .then((instance) => {
          unityInstance = instance;
          loadingBar.style.display = "none";

          fullscreenButton.onclick = () => {
            unityInstance.SetFullscreen(1);
          };
        })
        .catch((message) => alert(message));
    };

    document.body.appendChild(script);
  </script>

  <!-- ===================== -->
  <!-- HTML â†” UNITY BRIDGE -->
  <!-- ===================== -->

  <script>
    const nameInput = document.getElementById("nameInput");
    const startBtn = document.getElementById("startBtn");

    function ShowNameInput() {
      // ðŸ”¥ Kill Unity keyboard focus
      canvas.blur();
      canvas.style.pointerEvents = "none";

      nameInput.style.display = "block";
      startBtn.style.display = "block";

      // ðŸ”¥ Force browser keyboard focus
      setTimeout(() => {
        nameInput.focus();
      }, 0);
    }

    function HideNameInput() {
      nameInput.blur();

      nameInput.style.display = "none";
      startBtn.style.display = "none";
      nameInput.value = "";

      canvas.style.pointerEvents = "auto";
      canvas.focus(); // ðŸ”¥ Return control to Unity
    }

    function StartGame() {
      if (!unityInstance) return;

      const name = nameInput.value.trim();
      if (name.length === 0) return;

      unityInstance.SendMessage(
        "GameManager",
        "StartGameFromHTML",
        name
      );

      HideNameInput();
    }

    // ðŸ–±ï¸ Mouse
    startBtn.addEventListener("click", StartGame);

    // âŒ¨ï¸ ENTER key
    nameInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter") {
        e.preventDefault();
        StartGame();
      }
    });

    // ðŸ”’ Prevent Unity from stealing keys while typing
    document.addEventListener(
      "keydown",
      (e) => {
        if (nameInput.style.display === "block") {
          e.stopPropagation();
        }
      },
      true
    );
  </script>

</body>
</html>
